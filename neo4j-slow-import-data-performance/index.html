<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-import-data">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<title data-rh="true">Import data | Neo4j Performance Guide</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://neo4j-guide.com//neo4j-slow-import-data-performance"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Import data | Neo4j Performance Guide"><meta data-rh="true" name="description" content="Executing wast amounts of transactions in a small time frame can be an interesting engineering challenge. One example of this activity is importing huge amounts of data into the Neo4j graph database. Importing data in the Neo4j graph database can come with some performance difficulties. Let&#x27;s explore a few issues and how to handle them."><meta data-rh="true" property="og:description" content="Executing wast amounts of transactions in a small time frame can be an interesting engineering challenge. One example of this activity is importing huge amounts of data into the Neo4j graph database. Importing data in the Neo4j graph database can come with some performance difficulties. Let&#x27;s explore a few issues and how to handle them."><link data-rh="true" rel="canonical" href="https://neo4j-guide.com//neo4j-slow-import-data-performance"><link data-rh="true" rel="alternate" href="https://neo4j-guide.com//neo4j-slow-import-data-performance" hreflang="en"><link data-rh="true" rel="alternate" href="https://neo4j-guide.com//neo4j-slow-import-data-performance" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.198e1151.css">
<link rel="preload" href="/assets/js/runtime~main.347dbfbd.js" as="script">
<link rel="preload" href="/assets/js/main.4dbf7b4e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Neo4j Performance Guide</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/neo4j-slow-import-data-performance">Import data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/neo4j-slow-query-performance-issue">Indexing</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Import data</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Import data</h1></header><p>Executing wast amounts of transactions in a small time frame can be an interesting engineering challenge. One example of this activity is importing huge amounts of data into the Neo4j graph database. Importing data in the Neo4j graph database can come with some performance difficulties. Let&#x27;s explore a few issues and how to handle them.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="neo4j-slow-import-data-performance-issue">Neo4j slow import data performance issue<a class="hash-link" href="#neo4j-slow-import-data-performance-issue" title="Direct link to heading">​</a></h2><p>To visualize the issues and problems users can face with importing some larger chunks of data, take a look at this older issue <a href="https://stackoverflow.com/questions/19386260/neo4j-import-slowing-down" target="_blank" rel="noopener noreferrer">&quot;Neo4j import slowing down&quot;</a>. If you carefully read these issues, you can notice that the user is trying to import 500 000 nodes via Cypher queries. He has prepared for import following usual steps. The initial Cypher queries take some 15ms, while later slowing to 6000ms. But the fun part is his response to the initial question. After running the Cypher query import for 24 hours, he decided to kill it. Then he ran the java import tool, and everything was imported in 11 seconds. Viola! </p><p>This problem paints the picture of what you can run into while importing data in Neo4j database. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-avoid-neo4j-slow-importing">How to avoid Neo4j slow importing?<a class="hash-link" href="#how-to-avoid-neo4j-slow-importing" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites-for-efficient-import">Prerequisites for efficient import<a class="hash-link" href="#prerequisites-for-efficient-import" title="Direct link to heading">​</a></h3><p>To efficiently import data via Cypher/LOAD CSV, ensure that you have created appropriate unique property constraints. The unique constraint will implicitly create indexes for given properties.
If you what to create the uniqueness constraint on properties, you can do it this way: </p><div class="language-Cypher codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Cypher codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE CONSTRAINT foobar FOR (node:FooBar) REQUIRE node.id IS UNIQUE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will ensure that, in this case, merging on node <code>id</code> property will be efficient, which can impact the duration time of import.  </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="importing-via-cypher-query">Importing via Cypher query<a class="hash-link" href="#importing-via-cypher-query" title="Direct link to heading">​</a></h3><p>Importing via Cypher query can be quite simple and intuitive to try. Once the unique constraints and indexes are in place, you can execute the queries based on some CSV file. Here is the sample: </p><div class="language-Cypher codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Cypher codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LOAD CSV WITH HEADERS FROM &quot;file:///foobar.csv&quot; AS line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE (node:FooBar {id: toInteger(line.id))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>LOAD CSV will iterate over CVS and execute the query for each CSV line. Each query transaction will be committed to the database. But don&#x27;t skip the next two steps. There are more performance benefits to extract. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fix-cypher-query-import">Fix Cypher query import<a class="hash-link" href="#fix-cypher-query-import" title="Direct link to heading">​</a></h2><p>Executing Cypher queries line by line is a highway to hell if you have larger quantities of data. Running a Cypher query can slow down your performance because every Cypher query can become a single database transaction, which can bulk up the memory overhead. It would be best if you were careful with any Cypher query import on a large dataset.</p><p>But there is a way to improve it by using a special Cypher clause, <code>USING PERIODIC COMMIT</code>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">USING PERIODIC COMMIT 500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LOAD CSV WITH HEADERS FROM &quot;file:///foobar.csv&quot; AS line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CREATE (node:FooBar {id: toInteger(line.id))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using periodic commits, Neo4j will build up transactional data and make a smaller number of database commits, improving overall performance. But still, it will have performance issues with the load on big datasets. </p><p>There is also an APOC library for importing with periodic commits, you can check it out <a href="https://neo4j.com/labs/apoc/4.4/graph-updates/periodic-execution/" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="admin-import-tool">Admin import tool<a class="hash-link" href="#admin-import-tool" title="Direct link to heading">​</a></h2><p>One more option and only one for loading big datasets is by using the Neo4j admin import tool. The import tool is made to work on batch imports on large datasets, but it is made for import on previously unused databases. If you have a running database, you can load via <code>LOAD CSV,</code> but that will be slow, which can be a deal breaker for some. </p><p>Anyway, I hope this short guide helps. Feel free to search for more info on Neo4j docs about <a href="https://neo4j.com/docs/operations-manual/current/tools/neo4j-admin/neo4j-admin-import/" target="_blank" rel="noopener noreferrer">Admin import tool</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/neo4j-slow-query-performance-issue"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Indexing</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#neo4j-slow-import-data-performance-issue" class="table-of-contents__link toc-highlight">Neo4j slow import data performance issue</a></li><li><a href="#how-to-avoid-neo4j-slow-importing" class="table-of-contents__link toc-highlight">How to avoid Neo4j slow importing?</a><ul><li><a href="#prerequisites-for-efficient-import" class="table-of-contents__link toc-highlight">Prerequisites for efficient import</a></li><li><a href="#importing-via-cypher-query" class="table-of-contents__link toc-highlight">Importing via Cypher query</a></li></ul></li><li><a href="#fix-cypher-query-import" class="table-of-contents__link toc-highlight">Fix Cypher query import</a></li><li><a href="#admin-import-tool" class="table-of-contents__link toc-highlight">Admin import tool</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"></div></footer></div>
<script src="/assets/js/runtime~main.347dbfbd.js"></script>
<script src="/assets/js/main.4dbf7b4e.js"></script>
</body>
</html>