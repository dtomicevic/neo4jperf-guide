"use strict";(self.webpackChunkneo_4_jperf_guide=self.webpackChunkneo_4_jperf_guide||[]).push([[389],{3905:(e,n,t)=>{t.d(n,{Zo:()=>l,kt:()=>h});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var u=r.createContext({}),d=function(e){var n=r.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},l=function(e){var n=d(e.components);return r.createElement(u.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},c=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,u=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),c=d(t),h=a,m=c["".concat(u,".").concat(h)]||c[h]||p[h]||o;return t?r.createElement(m,i(i({ref:n},l),{},{components:t})):r.createElement(m,i({ref:n},l))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=c;var s={};for(var u in n)hasOwnProperty.call(n,u)&&(s[u]=n[u]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var d=2;d<o;d++)i[d]=t[d];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}c.displayName="MDXCreateElement"},1822:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var r=t(7462),a=(t(7294),t(3905));const o={title:"Indexing",sidebar_label:"Indexing",slug:"/neo4j-slow-query-performance-issue"},i=void 0,s={unversionedId:"indexing",id:"indexing",title:"Indexing",description:"Ahh, indexing! One of the most common pitfalls in database performance in general, Neo4j included, is the usage of indexes. At first, it may seem what I need and index for in the Graph database, but graphs can be stored as some other data structure in the background, this means you can index and optimize for storage data structure. The wrong usage of the index can make a database unusable, which can be quite painful. Let's see a few common issues with Neo4j database performance and indexes.",source:"@site/docs/indexing.md",sourceDirName:".",slug:"/neo4j-slow-query-performance-issue",permalink:"/neo4j-slow-query-performance-issue",draft:!1,tags:[],version:"current",frontMatter:{title:"Indexing",sidebar_label:"Indexing",slug:"/neo4j-slow-query-performance-issue"},sidebar:"neo4jperf_guide",previous:{title:"Import data",permalink:"/neo4j-slow-import-data-performance"}},u={},d=[{value:"Neo4j slow query performance issues",id:"neo4j-slow-query-performance-issues",level:2},{value:"How to avoid Neo4j index performance issues?",id:"how-to-avoid-neo4j-index-performance-issues",level:2},{value:"1. Index graph modeling",id:"1-index-graph-modeling",level:3},{value:"2. Setup the index",id:"2-setup-the-index",level:3},{value:"3. Use index in your query",id:"3-use-index-in-your-query",level:3},{value:"4. Labels are indexed",id:"4-labels-are-indexed",level:3}],l={toc:d};function p(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Ahh, indexing! One of the most common pitfalls in database performance in general, Neo4j included, is the usage of indexes. At first, it may seem what I need and index for in the Graph database, but graphs can be stored as some other data structure in the background, this means you can index and optimize for storage data structure. The wrong usage of the index can make a database unusable, which can be quite painful. Let's see a few common issues with Neo4j database performance and indexes. "),(0,a.kt)("h2",{id:"neo4j-slow-query-performance-issues"},"Neo4j slow query performance issues"),(0,a.kt)("p",null,"Look at this question from a few years ago at StackOverflow under the title ",(0,a.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/16997328/neo4j-performance-benchmarking"},'"Neo4j performance benchmarking"'),".\nIf you read the issue, you will notice that the user is complaining about Neo4j performance. The user has one million nodes, and a simple search by ID for some node takes an infinite 31 seconds. Without watching what is happening, you can assume this is not a realistic performance for any database.\nThis Neo4j poor performance probably means indexing is not working correctly. As it turns out, this Neo4j user didn't even set up the trigger, so the search is not very slow because it is brute forcing across the database. "),(0,a.kt)("p",null,"Here, take a look at this more recent query performance issue, ",(0,a.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/66270999/neo4j-3-5-query-performance-issue"},'"Neo4j 3.5 Query performance Issue"'),". Here the user has set up the index on the label ",(0,a.kt)("inlineCode",{parentName:"p"},"Application")," and property ",(0,a.kt)("inlineCode",{parentName:"p"},"name"),". But after running the Cypher query, Neo4j is consuming vast amounts of memory and taking quite some time.\nTurn's out the user Cypher query is not considering the index that the user has created because the user did not use it in the Cypher query. "),(0,a.kt)("h2",{id:"how-to-avoid-neo4j-index-performance-issues"},"How to avoid Neo4j index performance issues?"),(0,a.kt)("h3",{id:"1-index-graph-modeling"},"1. Index graph modeling"),(0,a.kt)("p",null,"Before even considering setting the index up, think about how your data is modeled. Data modeling will help you understand the graph structure, which you can use to increase your query performance.\nNotice how nodes and their properties are modeled. It would be best if you had an index on the node properties which you will often use for search.\nBare in mind that there will be few memory storage penalties. "),(0,a.kt)("h3",{id:"2-setup-the-index"},"2. Setup the index"),(0,a.kt)("p",null,"After importing the data, understanding the graph structure, and executing any queries, ensure you have created the trigger.\nTo create a trigger, you can use the query below: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cypher"},"CREATE INDEX index_name FOR (n:FooBar) ON (n.id)\n")),(0,a.kt)("p",null,"The Cypher query above will create the index on the node property. Make sure you have an index with some appropriate name because you can check it out later. "),(0,a.kt)("h3",{id:"3-use-index-in-your-query"},"3. Use index in your query"),(0,a.kt)("p",null,"The last part is to ensure your searches are optimized and your index is used in all Cypher queries from now on. In our example, every time we use a node ",(0,a.kt)("inlineCode",{parentName:"p"},"FooBar"),", we should try to use the ",(0,a.kt)("inlineCode",{parentName:"p"},"id")," property in the search. If we search ",(0,a.kt)("inlineCode",{parentName:"p"},"FooBar")," node with some other property that is not indexed, we will not get any performance benefits. In your case, make sure that when you use the node that has an index, also use the property your index is on. "),(0,a.kt)("h3",{id:"4-labels-are-indexed"},"4. Labels are indexed"),(0,a.kt)("p",null,"One more thing to keep in mind, if the database has multiple nodes with different labels, let's assume that our nodes have labels ",(0,a.kt)("inlineCode",{parentName:"p"},"FooBar"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Foo"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"Bar"),". Neo4j will automatically create the index for each of those labels, and you will be able to make somewhat performant queries. "),(0,a.kt)("p",null,"Neo4j has a lot of information in indexes. Feel free to jump to their official ",(0,a.kt)("a",{parentName:"p",href:"https://neo4j.com/docs/cypher-manual/current/indexes-for-search-performance/"},"docs")," for more information on indexes."))}p.isMDXComponent=!0}}]);