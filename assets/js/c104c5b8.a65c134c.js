"use strict";(self.webpackChunkneo_4_jperf_guide=self.webpackChunkneo_4_jperf_guide||[]).push([[609],{3905:(e,t,o)=>{o.d(t,{Zo:()=>m,kt:()=>f});var n=o(7294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var l=n.createContext({}),u=function(e){var t=n.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},m=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var o=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),c=u(o),f=r,y=c["".concat(l,".").concat(f)]||c[f]||p[f]||i;return o?n.createElement(y,a(a({ref:t},m),{},{components:o})):n.createElement(y,a({ref:t},m))}));function f(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=o.length,a=new Array(i);a[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,a[1]=s;for(var u=2;u<i;u++)a[u]=o[u];return n.createElement.apply(null,a)}return n.createElement.apply(null,o)}c.displayName="MDXCreateElement"},9747:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var n=o(7462),r=(o(7294),o(3905));const i={title:"Out of memory exception",sidebar_label:"Out of memory exception",slug:"/neo4j-out-of-memory"},a=void 0,s={unversionedId:"memory",id:"memory",title:"Out of memory exception",description:"Neo4j is built on top of bulky JVM, and with every JVM comes familiar out-of-memory exceptions. Since JVM has internal restrictions, running a database inside of JVM can lead to additional issues.",source:"@site/docs/memory.md",sourceDirName:".",slug:"/neo4j-out-of-memory",permalink:"/neo4j-out-of-memory",draft:!1,tags:[],version:"current",frontMatter:{title:"Out of memory exception",sidebar_label:"Out of memory exception",slug:"/neo4j-out-of-memory"},sidebar:"neo4jperf_guide",previous:{title:"Write speed",permalink:"/neo4j-slow-write-performance"},next:{title:"Performance configuration",permalink:"/neo4j-performance-issue"}},l={},u=[{value:"Neo4j out of memory issue",id:"neo4j-out-of-memory-issue",level:2},{value:"How to fix out-of-memory issues?",id:"how-to-fix-out-of-memory-issues",level:2},{value:"Optimize your Cypher query",id:"optimize-your-cypher-query",level:3},{value:"Set your memory limits",id:"set-your-memory-limits",level:3}],m={toc:u};function p(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,n.Z)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Neo4j is built on top of bulky JVM, and with every JVM comes familiar out-of-memory exceptions. Since JVM has internal restrictions, running a database inside of JVM can lead to additional issues. "),(0,r.kt)("h2",{id:"neo4j-out-of-memory-issue"},"Neo4j out of memory issue"),(0,r.kt)("p",null,"Out-of-memory issues and JVM are familiar, but let's see what the pain points with Neo4j are. If you search the Internet, you will find vast amounts of memory-related issues. Take a look at this ",(0,r.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/44698936/neo4j-delete-graph-out-of-memory"},'"Neo4j delete graph out of memory"'),". This stack overflow user wants to delete all nodes and relationships, 11 million entities.\nThe user runs simple Cypher: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"MATCH (n) \nDETACH DELETE n\n")),(0,r.kt)("p",null,"But after loading a while, there comes an ",(0,r.kt)("inlineCode",{parentName:"p"},"Out of memory")," exception. This issue can be fixed quite quickly, we will show how, and in most cases, these issues are quite easy to fix but can be pretty frustrating. "),(0,r.kt)("h2",{id:"how-to-fix-out-of-memory-issues"},"How to fix out-of-memory issues?"),(0,r.kt)("h3",{id:"optimize-your-cypher-query"},"Optimize your Cypher query"),(0,r.kt)("p",null,"In quite a few cases, there are some query issues. You can use ",(0,r.kt)("a",{parentName:"p",href:"/neo4j-performance-issue"},"Query tuning tool")," we mentioned in performance config.\nOut-of-memory issues are happening on some big workloads, and if your query is causing it, you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"PERIODIC COMMIT")," or APOC we mentioned in ",(0,r.kt)("a",{parentName:"p",href:"/neo4j-slow-write-performance"},"writing speed guide"),". In short, running your queries in batches is less memory intensive than running them all in a single chunk. "),(0,r.kt)("h3",{id:"set-your-memory-limits"},"Set your memory limits"),(0,r.kt)("p",null,"Since Neo4j is running on top of JVM, there is a possibility to configure JVM memory settings. Neo4j has an ",(0,r.kt)("inlineCode",{parentName:"p"},"neo4j.conf")," file for configuration, here is a ",(0,r.kt)("a",{parentName:"p",href:"https://neo4j.com/docs/operations-manual/current/reference/configuration-settings/"},"reference")," to all options.\nThere are three options that you can use to handle memory issues: "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dbms.memory.heap.initial_size")," "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dbms.memory.heap.max_size")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"dbms.jvm.additional"))),(0,r.kt)("p",null,"The Neo4j configuration parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"dbms.memory.heap.initial_size")," defines the initial reserved size of the memory heap available to Neo4j. If you do not set an exact value, the value is determined by JVM and available system resources. "),(0,r.kt)("p",null,"The next Neo4j configuration parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"dbms.memory.heap.max_size")," defines the upper limit on your Neo4j heap size. Again, if you do not set the value, it will be set by JVM explicitly. "),(0,r.kt)("p",null,"To set the parameters, you can write something like this: "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"dbms.memory.heap.initial_size=8GB\ndbms.memory.heap.max_size=16GB\n")),(0,r.kt)("p",null,"There is one more parameter related to JVM, ",(0,r.kt)("inlineCode",{parentName:"p"},"dbms.jvm.additional")," is used for setting additional options for the JVM, but keep in mind that it can depend on JVM implementations. "),(0,r.kt)("p",null,"Setting this argument can help you avoid memory issues, but bumping up the hardware specs will be the only option in some cases. There is also a useful Neo4j guide on ",(0,r.kt)("a",{parentName:"p",href:"https://neo4j.com/docs/operations-manual/current/performance/gc-tuning/"},"garbage collector"),", that explains these arguments in more detail."))}p.isMDXComponent=!0}}]);