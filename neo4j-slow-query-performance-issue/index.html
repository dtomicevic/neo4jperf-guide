<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-indexing">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-rc.1">
<title data-rh="true">Indexing | Neo4j Performance Guide</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://neo4j-guide.com//neo4j-slow-query-performance-issue"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Indexing | Neo4j Performance Guide"><meta data-rh="true" name="description" content="Ahh, indexing! One of the most common pitfalls in database performance in general, Neo4j included, is the usage of indexes. At first, it may seem what I need and index for in the Graph database, but graphs can be stored as some other data structure in the background, this means you can index and optimize for storage data structure. The wrong usage of the index can make a database unusable, which can be quite painful. Let&#x27;s see a few common issues with Neo4j database performance and indexes."><meta data-rh="true" property="og:description" content="Ahh, indexing! One of the most common pitfalls in database performance in general, Neo4j included, is the usage of indexes. At first, it may seem what I need and index for in the Graph database, but graphs can be stored as some other data structure in the background, this means you can index and optimize for storage data structure. The wrong usage of the index can make a database unusable, which can be quite painful. Let&#x27;s see a few common issues with Neo4j database performance and indexes."><link data-rh="true" rel="canonical" href="https://neo4j-guide.com//neo4j-slow-query-performance-issue"><link data-rh="true" rel="alternate" href="https://neo4j-guide.com//neo4j-slow-query-performance-issue" hreflang="en"><link data-rh="true" rel="alternate" href="https://neo4j-guide.com//neo4j-slow-query-performance-issue" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.198e1151.css">
<link rel="preload" href="/assets/js/runtime~main.347dbfbd.js" as="script">
<link rel="preload" href="/assets/js/main.4dbf7b4e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Neo4j Performance Guide</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/neo4j-slow-import-data-performance">Import data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/neo4j-slow-query-performance-issue">Indexing</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Indexing</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Indexing</h1></header><p>Ahh, indexing! One of the most common pitfalls in database performance in general, Neo4j included, is the usage of indexes. At first, it may seem what I need and index for in the Graph database, but graphs can be stored as some other data structure in the background, this means you can index and optimize for storage data structure. The wrong usage of the index can make a database unusable, which can be quite painful. Let&#x27;s see a few common issues with Neo4j database performance and indexes. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="neo4j-slow-query-performance-issues">Neo4j slow query performance issues<a class="hash-link" href="#neo4j-slow-query-performance-issues" title="Direct link to heading">​</a></h2><p>Look at this question from a few years ago at StackOverflow under the title <a href="https://stackoverflow.com/questions/16997328/neo4j-performance-benchmarking" target="_blank" rel="noopener noreferrer">&quot;Neo4j performance benchmarking&quot;</a>.
If you read the issue, you will notice that the user is complaining about Neo4j performance. The user has one million nodes, and a simple search by ID for some node takes an infinite 31 seconds. Without watching what is happening, you can assume this is not a realistic performance for any database.
This Neo4j poor performance probably means indexing is not working correctly. As it turns out, this Neo4j user didn&#x27;t even set up the trigger, so the search is not very slow because it is brute forcing across the database. </p><p>Here, take a look at this more recent query performance issue, <a href="https://stackoverflow.com/questions/66270999/neo4j-3-5-query-performance-issue" target="_blank" rel="noopener noreferrer">&quot;Neo4j 3.5 Query performance Issue&quot;</a>. Here the user has set up the index on the label <code>Application</code> and property <code>name</code>. But after running the Cypher query, Neo4j is consuming vast amounts of memory and taking quite some time.
Turn&#x27;s out the user Cypher query is not considering the index that the user has created because the user did not use it in the Cypher query. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-avoid-neo4j-index-performance-issues">How to avoid Neo4j index performance issues?<a class="hash-link" href="#how-to-avoid-neo4j-index-performance-issues" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-index-graph-modeling">1. Index graph modeling<a class="hash-link" href="#1-index-graph-modeling" title="Direct link to heading">​</a></h3><p>Before even considering setting the index up, think about how your data is modeled. Data modeling will help you understand the graph structure, which you can use to increase your query performance.
Notice how nodes and their properties are modeled. It would be best if you had an index on the node properties which you will often use for search.
Bare in mind that there will be few memory storage penalties. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-setup-the-index">2. Setup the index<a class="hash-link" href="#2-setup-the-index" title="Direct link to heading">​</a></h3><p>After importing the data, understanding the graph structure, and executing any queries, ensure you have created the trigger.
To create a trigger, you can use the query below: </p><div class="language-cypher codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cypher codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CREATE INDEX index_name FOR (n:FooBar) ON (n.id)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The Cypher query above will create the index on the node property. Make sure you have an index with some appropriate name because you can check it out later. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-use-index-in-your-query">3. Use index in your query<a class="hash-link" href="#3-use-index-in-your-query" title="Direct link to heading">​</a></h3><p>The last part is to ensure your searches are optimized and your index is used in all Cypher queries from now on. In our example, every time we use a node <code>FooBar</code>, we should try to use the <code>id</code> property in the search. If we search <code>FooBar</code> node with some other property that is not indexed, we will not get any performance benefits. In your case, make sure that when you use the node that has an index, also use the property your index is on. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-labels-are-indexed">4. Labels are indexed<a class="hash-link" href="#4-labels-are-indexed" title="Direct link to heading">​</a></h3><p>One more thing to keep in mind, if the database has multiple nodes with different labels, let&#x27;s assume that our nodes have labels <code>FooBar</code>, <code>Foo</code>, and <code>Bar</code>. Neo4j will automatically create the index for each of those labels, and you will be able to make somewhat performant queries. </p><p>Neo4j has a lot of information in indexes. Feel free to jump to their official <a href="https://neo4j.com/docs/cypher-manual/current/indexes-for-search-performance/" target="_blank" rel="noopener noreferrer">docs</a> for more information on indexes.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/neo4j-slow-import-data-performance"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Import data</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#neo4j-slow-query-performance-issues" class="table-of-contents__link toc-highlight">Neo4j slow query performance issues</a></li><li><a href="#how-to-avoid-neo4j-index-performance-issues" class="table-of-contents__link toc-highlight">How to avoid Neo4j index performance issues?</a><ul><li><a href="#1-index-graph-modeling" class="table-of-contents__link toc-highlight">1. Index graph modeling</a></li><li><a href="#2-setup-the-index" class="table-of-contents__link toc-highlight">2. Setup the index</a></li><li><a href="#3-use-index-in-your-query" class="table-of-contents__link toc-highlight">3. Use index in your query</a></li><li><a href="#4-labels-are-indexed" class="table-of-contents__link toc-highlight">4. Labels are indexed</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"></div></footer></div>
<script src="/assets/js/runtime~main.347dbfbd.js"></script>
<script src="/assets/js/main.4dbf7b4e.js"></script>
</body>
</html>